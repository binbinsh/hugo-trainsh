{{ define "main" }}
  {{ with site.Params.home.intro }}
    <section class="home-intro">
      <blockquote>{{ . | markdownify }}</blockquote>
    </section>
  {{ end }}

  {{ with site.Taxonomies.tags }}
    {{ $limit := (site.Params.home.tags.limit | default 10) }}
    {{ $showCount := (site.Params.home.tags.showCount | default true) }}
    {{ $tags := .ByCount }}
    {{ if and (gt $limit 0) (lt $limit (len $tags)) }}
      {{ $tags = first $limit $tags }}
    {{ end }}
    <section class="home-tags">
      <div class="home-tags__header">
        <h2>{{ i18n "popular_tags" }}</h2>
      </div>
      <ul class="tag-list">
        {{ range $tags }}
          <li>
            <a class="tag-chip tag-sm" href="{{ .Page.RelPermalink }}">{{ .Page.LinkTitle | lower | replaceRE "\\s+" "-" }}</a>
          </li>
        {{ end }}
        {{ with site.GetPage "/tags" }}
          <li class="tag-list__more">
            <a class="tag-button" href="{{ .RelPermalink }}">{{ i18n "more_tags" }}</a>
          </li>
        {{ end }}
      </ul>
    </section>
  {{ end }}

  {{ $recentN := (site.Params.home.recent.limit | default 5) }}
  {{ $posts := where site.RegularPages "Section" "posts" }}
  {{ with $posts }}
    <section class="home-recent">
      <h2>{{ i18n "recent_posts" }}</h2>
      {{/* compact list, no card spacing */}}
      <ul class="home-recent-list">
        {{ range first $recentN (.ByDate.Reverse) }}
          <li>
            {{ $machine := .Date | time.Format "2006-01-02T15:04:05-07:00" }}
            {{ $human := .Date | time.Format "2006-01-02" }}
            <time class="date" datetime="{{ $machine }}">{{ $human }}</time>
            <a class="archive-title" href="{{ .RelPermalink }}">{{ .LinkTitle }}</a>
          </li>
        {{ end }}
      </ul>
      {{ $moreText := i18n "more_posts" }}
      {{ if site.Params.home.recent.moreURL }}
        <p class="more"><a href="{{ site.Params.home.recent.moreURL }}">{{ $moreText }}</a></p>
      {{ else }}
        {{ with site.GetPage "/archive" }}
          <p class="more"><a href="{{ .RelPermalink }}">{{ $moreText }}</a></p>
        {{ else }}
          {{ with site.GetPage "/posts" }}
            <p class="more"><a href="{{ .RelPermalink }}">{{ $moreText }}</a></p>
          {{ end }}
        {{ end }}
      {{ end }}
    </section>
  {{ end }}

  <section class="home-search">
    <h2>{{ i18n "search_posts" }}</h2>
    <input id="archive-search" type="search" placeholder="{{ i18n "type_to_search" }}" autocomplete="off">
    <section id="archive-results" hidden></section>
  </section>
{{ end }}
