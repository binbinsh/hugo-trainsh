{{ define "main" }}
  {{- if .Content -}}
    {{ .Content }}
  {{- else -}}
    {{- with site.Params.home.intro -}}
      {{ . | markdownify }}
    {{- end -}}
  {{- end -}}

  {{- $sections := default (slice "posts") site.Params.mainSections -}}
  {{- $posts := where site.RegularPages "Section" "in" $sections -}}

  {{- $recentLimit := (site.Params.home.recent.limit | default 5) -}}
  {{- $popularLimit := (site.Params.home.popular.limit | default 5) -}}

  <h3>{{ i18n "home_most_recent_posts" }}</h3>
  <ul>
    {{- range first $recentLimit ($posts.ByDate.Reverse) -}}
      <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
    {{- end -}}
  </ul>

  <h3>{{ i18n "home_most_popular_posts" }}</h3>
  {{- $infoEndpoint := "" -}}
  {{- with site.Params.upvote -}}
    {{- $infoEndpoint = .infoEndpoint | default "/api/upvote-info" -}}
  {{- end -}}
  {{- $candidateLimit := (site.Params.home.popular.candidateLimit | default 50) -}}
  <ul id="home-popular-posts"
      data-limit="{{ $popularLimit }}"
      data-index-url="{{ "index.json" | relURL }}"
      data-candidate-limit="{{ $candidateLimit }}"
      data-info-endpoint="{{ $infoEndpoint }}"
      {{- if $infoEndpoint -}}data-popular-state="loading" aria-busy="true"{{- end -}}>
    {{- range first $popularLimit (shuffle $posts) -}}
      <li><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
    {{- end -}}
  </ul>
{{ end }}
