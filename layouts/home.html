{{ define "main" }}
  {{ with site.Params.home.intro }}
  <section class="mb-12">
    <p class="text-[var(--color-muted)]">{{ . | markdownify }}</p>
  </section>
  {{ end }}

  {{ with site.Taxonomies.tags }}
  {{ $limit := (site.Params.home.tags.limit | default 10) }}
  {{ $tags := .ByCount }}
  {{ if and (gt $limit 0) (lt $limit (len $tags)) }}
    {{ $tags = first $limit $tags }}
  {{ end }}
  <section class="mb-12">
    <h2 class="text-lg font-semibold mb-4">{{ i18n "popular_tags" }}</h2>
    <div class="flex flex-wrap gap-2">
      {{ range $tags }}
      <a href="{{ .Page.RelPermalink }}" class="px-3 py-1 text-sm bg-[var(--color-surface)] border border-[var(--color-border)] rounded-full hover:border-[var(--color-accent)] hover:text-[var(--color-accent)] transition-colors">
        {{ .Page.LinkTitle | lower | replaceRE "\\s+" "-" }}
      </a>
      {{ end }}
    </div>
    {{ with site.GetPage "/tags" }}
    <p class="mt-4"><a href="{{ .RelPermalink }}" class="text-[var(--color-accent)] hover:underline">{{ i18n "more_tags" }} →</a></p>
    {{ end }}
  </section>
  {{ end }}

  {{ $recentN := (site.Params.home.recent.limit | default 5) }}
  {{ $sections := default (slice "posts") site.Params.mainSections }}
  {{ $posts := where site.RegularPages "Section" "in" $sections }}
  {{ with $posts }}
  <section class="mb-12">
    <h2 class="text-lg font-semibold mb-4">{{ i18n "recent_posts" }}</h2>
    <ul class="space-y-3">
      {{ range first $recentN (.ByDate.Reverse) }}
      <li class="flex gap-4 items-baseline">
        <time class="text-sm text-[var(--color-muted)] font-mono shrink-0" datetime="{{ .Date | time.Format "2006-01-02" }}">
          {{ .Date | time.Format "Jan 02, 2006" }}
        </time>
        <a href="{{ .RelPermalink }}" class="hover:text-[var(--color-accent)] transition-colors">
          {{ .LinkTitle }}
        </a>
      </li>
      {{ end }}
    </ul>
    {{ $moreText := i18n "more_posts" }}
    {{ if site.Params.home.recent.moreURL }}
    <p class="mt-4"><a href="{{ site.Params.home.recent.moreURL }}" class="text-[var(--color-accent)] hover:underline">{{ $moreText }} →</a></p>
    {{ else }}
    {{ with site.GetPage "/archive" }}
    <p class="mt-4"><a href="{{ .RelPermalink }}" class="text-[var(--color-accent)] hover:underline">{{ $moreText }} →</a></p>
    {{ else }}
    {{ with site.GetPage (printf "/%s" (index $sections 0)) }}
    <p class="mt-4"><a href="{{ .RelPermalink }}" class="text-[var(--color-accent)] hover:underline">{{ $moreText }} →</a></p>
    {{ end }}
    {{ end }}
    {{ end }}
  </section>
  {{ end }}

{{ end }}
