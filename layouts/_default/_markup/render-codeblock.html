{{- /* Mark page as containing code so we can conditionally preload mono font */ -}}
{{- .Page.Store.Set "hasCode" true -}}

{{- /* Determine language label; default to plain text. */ -}}
{{- $file := or .Attributes.file "" -}}
{{- $ext := strings.TrimPrefix "." (path.Ext $file) -}}
{{- $lang := or .Type $ext "text" -}}
{{- if in (slice "html" "gotmpl") $lang -}}
  {{- $lang = "go-html-template" -}}
{{- end -}}
{{- $label := cond (eq $lang "text") "plain text" $lang -}}

{{- /* Disable table-based line numbers; force CSS-class output for Chroma */ -}}
{{- $opts := dict "linenos" false "lineNumbersInTable" false "anchorLineNos" false "noClasses" false "guessSyntax" true -}}

<div class="codeblock" data-lang="{{ $lang }}">
  <div class="codeblock-header">
    <span class="code-lang">{{ $label }}</span>
    <button class="copy-btn" type="button" data-copy-code aria-label="Copy code">Copy</button>
  </div>
  <div class="codeblock-content with-line-numbers">
    {{- /* Highlight without line numbers */ -}}
    {{- transform.Highlight (strings.TrimSpace .Inner) $lang $opts -}}
  </div>
</div>

