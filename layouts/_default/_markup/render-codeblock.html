{{- .Page.Store.Set "hasCode" true -}}

{{- $file := or .Attributes.file "" -}}
{{- $ext := strings.TrimPrefix "." (path.Ext $file) -}}
{{- $lang := or .Type $ext "text" -}}
{{- if in (slice "html" "gotmpl") $lang -}}
  {{- $lang = "go-html-template" -}}
{{- end -}}
{{- $label := cond (eq $lang "text") "plain text" $lang -}}

{{- $opts := dict "linenos" false "lineNumbersInTable" false "anchorLineNos" false "noClasses" true "guessSyntax" true -}}

<div class="codeblock my-4 rounded-lg overflow-hidden border border-[var(--color-border)]">
  <div class="codeblock-header flex items-center justify-between px-3 py-1 bg-[var(--color-code-bg)] border-b border-[var(--color-border)]">
    <span class="text-xs text-[var(--color-muted)] font-mono">{{ strings.ToUpper $label }}</span>
    <div class="flex items-center gap-1">
      <button type="button" data-wrap-toggle aria-label="Toggle word wrap" title="Toggle word wrap" class="text-xs px-1.5 py-0.5 rounded text-[var(--color-muted)] hover:bg-[var(--color-surface)] hover:text-[var(--color-fg)] transition-colors cursor-pointer">
        WRAP
      </button>
      <button type="button" data-copy-code aria-label="Copy code" class="text-xs px-1.5 py-0.5 rounded text-[var(--color-muted)] hover:bg-[var(--color-surface)] hover:text-[var(--color-fg)] transition-colors cursor-pointer">
        COPY
      </button>
    </div>
  </div>
  {{- transform.Highlight (strings.TrimSpace .Inner) $lang $opts -}}
</div>
